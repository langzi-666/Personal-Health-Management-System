# 第4-5周 快速启动指南

## 📋 前置要求

- Java 11+
- Node.js 16+
- MySQL 8.0
- 已完成第1-3周的初始化

---

## 🚀 快速启动步骤

### 1. 数据库设置

在 MySQL 中执行以下 SQL 创建新表（连接信息：host=localhost, user=root, password=123456, db=health_management_system）：

```sql
-- 血糖记录表
CREATE TABLE blood_glucose_records (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  glucose_value DECIMAL(5,2) NOT NULL,
  measurement_type VARCHAR(50),
  record_date DATE NOT NULL,
  record_time VARCHAR(10),
  notes TEXT,
  create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  KEY idx_user_date (user_id, record_date)
) CHARSET=utf8mb4;

-- 运动记录表
CREATE TABLE exercise_records (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  exercise_type VARCHAR(50) NOT NULL,
  duration INT,
  intensity VARCHAR(20),
  calories_burned DECIMAL(8,2),
  record_date DATE NOT NULL,
  record_time VARCHAR(10),
  notes TEXT,
  create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  KEY idx_user_date (user_id, record_date)
) CHARSET=utf8mb4;

-- 睡眠记录表
CREATE TABLE sleep_records (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  bed_time VARCHAR(10),
  wake_time VARCHAR(10),
  sleep_duration DECIMAL(4,2),
  sleep_quality INT,
  record_date DATE NOT NULL,
  notes TEXT,
  create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  KEY idx_user_date (user_id, record_date)
) CHARSET=utf8mb4;

-- 饮食记录表
CREATE TABLE diet_records (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  food_name VARCHAR(100) NOT NULL,
  category VARCHAR(50),
  quantity VARCHAR(50),
  calories DECIMAL(8,2),
  protein DECIMAL(8,2),
  fat DECIMAL(8,2),
  carbohydrates DECIMAL(8,2),
  record_date DATE NOT NULL,
  record_time VARCHAR(10),
  notes TEXT,
  create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  KEY idx_user_date (user_id, record_date)
) CHARSET=utf8mb4;

-- 心理健康记录表
CREATE TABLE mental_health_records (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  mood_score INT,
  stress_level VARCHAR(20),
  anxiety_level INT,
  mentals_state VARCHAR(50),
  record_date DATE NOT NULL,
  record_time VARCHAR(10),
  notes TEXT,
  create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  KEY idx_user_date (user_id, record_date)
) CHARSET=utf8mb4;
```

### 2. 后端启动

```bash
# 进入后端目录
cd backend

# Maven 构建
mvn clean install

# 运行应用（在IDE中运行 HealthManagementApplication.java 或使用以下命令）
mvn spring-boot:run
```

后端服务将在 `http://localhost:8080` 启动

### 3. 前端启动

```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install

# 开发模式启动
npm run dev
```

前端服务将在 `http://localhost:5173` 启动

---

## 🧪 测试流程

### 1. 登录系统
- 访问 `http://localhost:5173`
- 如没有账号，先注册一个账号
- 使用账号登录

### 2. 进入仪表板
- 登录后自动重定向或手动访问 `http://localhost:5173/layout/dashboard`
- 应能看到：
  - 快捷卡片区（4个）：今日摄入、运动、睡眠、步数
  - 数据概览区（3个）：最新体重、血压、血糖
  - 周统计和月统计信息
  - 快速操作按钮

### 3. 测试血糖记录
- 点击菜单 "数据记录" → "血糖"
- 或直接访问 `http://localhost:5173/layout/glucose-record`
- 测试功能：
  - 填写表单（血糖值、类型、日期、时间）
  - 点击"添加记录"
  - 在列表中验证数据
  - 测试编辑功能
  - 测试删除功能
  - 测试日期范围过滤
  - 测试分页

### 4. 测试运动记录
- 点击菜单 "数据记录" → "运动"
- 进行与血糖相同的功能测试
- 特别注意：运动强度、卡路里等字段

### 5. 测试睡眠记录
- 点击菜单 "数据记录" → "睡眠"
- 测试特殊功能：
  - 睡眠质量滑块（1-10）
  - 星级评分显示

### 6. 测试饮食记录
- 点击菜单 "数据记录" → "饮食"
- 测试特殊功能：
  - 多个营养字段（蛋白质、脂肪、碳水）
  - 食物分类下拉选择

### 7. 测试心理健康记录
- 点击菜单 "数据记录" → "心理健康"
- 测试特殊功能：
  - 心情评分和焦虑程度滑块
  - 压力等级彩色标签
  - 心理状态下拉选择

### 8. 验证仪表板数据更新
- 添加一些测试数据后，返回仪表板
- 验证数据是否正确更新
- 特别关注：
  - 最新数据展示
  - 统计数据计算准确性

---

## 📊 API 测试（使用 Postman 或 curl）

### 测试血糖 API

```bash
# 添加血糖记录
curl -X POST http://localhost:8080/api/health/blood-glucose \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 1,
    "glucoseValue": 5.5,
    "measurementType": "空腹",
    "recordDate": "2024-01-15",
    "recordTime": "08:00",
    "notes": "早上空腹测试"
  }'

# 查询血糖列表
curl -X GET "http://localhost:8080/api/health/blood-glucose?userId=1&pageNum=1&pageSize=10"

# 更新血糖记录
curl -X PUT http://localhost:8080/api/health/blood-glucose/1 \
  -H "Content-Type: application/json" \
  -d '{
    "glucoseValue": 5.8
  }'

# 删除血糖记录
curl -X DELETE http://localhost:8080/api/health/blood-glucose/1
```

### 测试分析 API

```bash
# 获取最新数据
curl -X GET "http://localhost:8080/api/analysis/latest?userId=1"

# 获取今日统计
curl -X GET "http://localhost:8080/api/analysis/today-summary?userId=1"

# 获取周统计
curl -X GET "http://localhost:8080/api/analysis/weekly-summary?userId=1"

# 获取月统计
curl -X GET "http://localhost:8080/api/analysis/monthly-summary?userId=1"
```

---

## 🔍 常见问题

### Q1: 后端启动失败，提示数据库连接错误
**A:** 检查 MySQL 是否运行，确保连接信息正确（host=localhost, port=3306, user=root, password=123456）

### Q2: 前端无法加载页面
**A:** 确保后端服务正在运行，并且 CORS 跨域配置正确（已在 CorsConfig.java 中配置）

### Q3: 添加数据后列表不更新
**A:** 检查浏览器控制台是否有错误，可能是 API 调用失败

### Q4: 分页不工作
**A:** 确保 watch 监听器正确监听 pageNum 和 pageSize 的变化

### Q5: 日期过滤返回结果为空
**A:** 确保测试数据的 recordDate 在选择的日期范围内

---

## 📈 性能优化建议（可选）

1. **添加数据库索引** - 已在建表 SQL 中包含 idx_user_date 索引
2. **启用缓存** - 考虑为分析接口添加 Redis 缓存
3. **实现懒加载** - 对于大量数据可考虑虚拟滚动
4. **异步加载** - 使用 Promise.all 并行加载多个数据源

---

## 📚 代码文件位置

### 后端文件
- 实体类：`backend/src/main/java/com/health/entity/`
- Mapper：`backend/src/main/java/com/health/mapper/`
- Service：`backend/src/main/java/com/health/service/`
- Controller：`backend/src/main/java/com/health/controller/`

### 前端文件
- API：`frontend/src/api/`（health.js, analysis.js）
- 页面：`frontend/src/views/`（*Record.vue, Dashboard.vue）
- 路由：`frontend/src/router/index.js`
- 布局：`frontend/src/views/Layout.vue`

---

## ✨ 成功指标

完成以下验证即表示开发成功：

- [x] 后端服务成功启动在 8080 端口
- [x] 前端应用成功启动在 5173 端口
- [x] 能够添加/编辑/删除血糖、运动、睡眠、饮食、心理健康数据
- [x] 列表能够显示所有记录
- [x] 日期过滤功能正常
- [x] 分页功能正常
- [x] 仪表板能够显示最新数据
- [x] 仪表板统计数据准确
- [x] 快速操作按钮能正确导航到各页面

---

## 下一步

完成第4-5周后，可以进行第6周的开发（数据分析与图表），需要：
- 集成 ECharts 库
- 实现多种图表显示
- 创建分析页面
- 实现数据导出功能

