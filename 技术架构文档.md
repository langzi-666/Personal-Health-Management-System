# 个人健康管理系统 - 技术架构文档

## 1. 技术栈概览

### 1.1 前端技术栈
- **框架**：Vue.js 3.x
- **构建工具**：Vite
- **UI组件库**：Element Plus / Bootstrap Vue
- **图表库**：ECharts 5.x
- **状态管理**：Vuex / Pinia
- **HTTP客户端**：Axios
- **路由**：Vue Router 4.x
- **样式**：Tailwind CSS / SCSS

### 1.2 后端技术栈
- **语言**：Java 11+
- **框架**：Spring Boot 2.7.x / 3.x
- **ORM框架**：MyBatis / MyBatis Plus
- **数据库**：MySQL 8.0
- **缓存**：Redis (可选)
- **API文档**：Knife4j / Swagger3
- **安全认证**：JWT (Spring Security)
- **日志**：Logback / Log4j2
- **构建工具**：Maven

### 1.3 数据库
- **主数据库**：MySQL 8.0
- **缓存数据库**：Redis (可选)
- **连接池**：Druid / HikariCP

---

## 2. 系统架构设计

### 2.1 整体架构图
```
┌─────────────────────────────────────────────────────────────┐
│                    用户浏览器 / 移动设备                      │
└────────────────────┬──────────────────────────────────────────┘
                     │ HTTPS
┌────────────────────▼──────────────────────────────────────────┐
│                     前端应用 (Vue.js)                         │
│  ├─ 登录认证页面                                             │
│  ├─ 仪表板 (Dashboard)                                       │
│  ├─ 数据记录页面                                             │
│  ├─ 数据分析页面                                             │
│  ├─ 个人设置页面                                             │
│  └─ 通知中心                                                 │
└────────────────────┬──────────────────────────────────────────┘
                     │ RESTful API (Axios)
┌────────────────────▼──────────────────────────────────────────┐
│                  后端应用 (Spring Boot)                       │
│  ┌────────────────────────────────────────────────────────┐  │
│  │               Controller 层 (控制层)                     │  │
│  │  ├─ UserController (用户相关)                           │  │
│  │  ├─ HealthDataController (健康数据)                     │  │
│  │  ├─ AnalysisController (数据分析)                       │  │
│  │  └─ NotificationController (通知)                       │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │               Service 层 (业务逻辑)                     │  │
│  │  ├─ UserService (用户业务逻辑)                          │  │
│  │  ├─ HealthDataService (数据处理)                        │  │
│  │  ├─ AnalysisService (分析统计)                          │  │
│  │  └─ NotificationService (通知逻辑)                      │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │               Mapper 层 (数据访问)                      │  │
│  │  ├─ UserMapper                                          │  │
│  │  ├─ WeightMapper                                        │  │
│  │  ├─ BloodPressureMapper                                 │  │
│  │  ├─ ExerciseMapper                                      │  │
│  │  ├─ SleepMapper                                         │  │
│  │  └─ NotificationMapper                                  │  │
│  └────────────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │               Util 层 (工具类)                          │  │
│  │  ├─ JwtUtil (JWT令牌)                                   │  │
│  │  ├─ DateUtil (日期处理)                                 │  │
│  │  ├─ EncryptUtil (加密解密)                              │  │
│  │  └─ FileUtil (文件处理)                                 │  │
│  └────────────────────────────────────────────────────────┘  │
└────────────────────┬──────────────────────────────────────────┘
                     │
                     ▼
         ┌───────────────────────────┐
         │   MySQL 8.0 数据库        │
         │  ├─ 用户表                │
         │  ├─ 体重记录表            │
         │  ├─ 血压记录表            │
         │  ├─ 血糖记录表            │
         │  ├─ 运动记录表            │
         │  ├─ 睡眠记录表            │
         │  ├─ 饮食记录表            │
         │  └─ 通知表                │
         └───────────────────────────┘
```

### 2.2 前端架构

#### 文件结构
```
frontend/
├── public/
│   └── index.html
├── src/
│   ├── assets/           # 静态资源 (图片、字体等)
│   ├── components/       # 可复用组件
│   │   ├── common/       # 通用组件 (Header、Footer等)
│   │   ├── charts/       # 图表组件
│   │   └── form/         # 表单组件
│   ├── views/            # 页面组件
│   │   ├── Login.vue
│   │   ├── Dashboard.vue
│   │   ├── HealthRecord/
│   │   ├── Analysis.vue
│   │   ├── Settings.vue
│   │   └── NotificationCenter.vue
│   ├── router/           # 路由配置
│   │   └── index.js
│   ├── store/            # 状态管理 (Vuex/Pinia)
│   ├── api/              # API调用
│   │   ├── user.js
│   │   ├── health.js
│   │   └── analysis.js
│   ├── utils/            # 工具函数
│   │   ├── request.js    # Axios配置
│   │   ├── storage.js    # 本地存储
│   │   └── format.js     # 数据格式化
│   ├── styles/           # 全局样式
│   ├── main.js           # 入口文件
│   └── App.vue           # 根组件
├── vite.config.js        # Vite配置
├── package.json
└── .env                  # 环境变量
```

### 2.3 后端架构

#### 文件结构
```
backend/
├── src/main/java/com/health/
│   ├── HealthManagementApplication.java  # 启动类
│   ├── controller/
│   │   ├── UserController.java
│   │   ├── HealthDataController.java
│   │   ├── AnalysisController.java
│   │   └── NotificationController.java
│   ├── service/
│   │   ├── UserService.java
│   │   ├── HealthDataService.java
│   │   ├── AnalysisService.java
│   │   └── NotificationService.java
│   ├── mapper/
│   │   ├── UserMapper.java
│   │   ├── HealthDataMapper.java
│   │   └── NotificationMapper.java
│   ├── entity/
│   │   ├── User.java
│   │   ├── Weight.java
│   │   ├── BloodPressure.java
│   │   ├── Exercise.java
│   │   ├── Sleep.java
│   │   ├── Diet.java
│   │   └── Notification.java
│   ├── dto/
│   │   ├── LoginDTO.java
│   │   ├── RegisterDTO.java
│   │   ├── HealthDataDTO.java
│   │   └── ResponseDTO.java
│   ├── config/
│   │   ├── JwtConfig.java
│   │   ├── DataSourceConfig.java
│   │   └── SwaggerConfig.java
│   ├── exception/
│   │   ├── CustomException.java
│   │   └── GlobalExceptionHandler.java
│   ├── utils/
│   │   ├── JwtUtil.java
│   │   ├── DateUtil.java
│   │   ├── EncryptUtil.java
│   │   └── ResponseUtil.java
│   └── filter/
│       └── JwtAuthenticationFilter.java
├── src/main/resources/
│   ├── application.yml       # 配置文件
│   ├── application-dev.yml   # 开发环境配置
│   ├── application-prod.yml  # 生产环境配置
│   └── sql/
│       └── init.sql          # 初始化SQL
├── pom.xml
└── .env
```

---

## 3. 核心模块详解

### 3.1 用户认证模块

#### 工作流程
```
用户输入凭证
    ↓
前端 → POST /api/auth/login
    ↓
后端 UserController.login()
    ↓
UserService 验证用户信息
    ↓
密码匹配 → 生成JWT Token
    ↓
返回 Token 给前端
    ↓
前端存储 Token (LocalStorage)
    ↓
后端请求都在 Header 中携带 Token
```

#### JWT Token 结构
- **Header**: 包含算法类型 (HS256)
- **Payload**: 包含用户ID、用户名、过期时间
- **Signature**: 数字签名，用于验证

### 3.2 健康数据记录模块

#### 数据流程
```
用户输入数据
    ↓
前端验证数据
    ↓
POST /api/health/{type}/record (如 /api/health/weight/record)
    ↓
后端 HealthDataController
    ↓
HealthDataService 业务处理
    ↓
Mapper 层持久化到数据库
    ↓
返回成功响应
```

### 3.3 数据分析模块

#### 分析维度
- **时间维度**：日、周、月、年
- **数据维度**：平均值、最大值、最小值、变化趋势
- **对比维度**：环比、同比

#### 缓存策略
- 使用 Redis 缓存统计结果
- 每日凌晨1点更新统计数据
- 用户修改数据时更新相关缓存

---

## 4. 数据库设计原则

### 4.1 表设计规范
- 每个表都有主键 `id` (自增)
- 每个表都有 `create_time` 和 `update_time`
- 使用下划线命名法 (snake_case)
- 字段添加注释说明用途

### 4.2 索引策略
- 在外键上建立索引
- 在常用查询条件字段上建立索引
- 在时间字段上建立索引

---

## 5. API设计规范

### 5.1 RESTful API 设计
```
GET    /api/users/{id}              # 获取用户信息
POST   /api/users                   # 创建用户
PUT    /api/users/{id}              # 更新用户
DELETE /api/users/{id}              # 删除用户

GET    /api/health/weight           # 获取体重记录列表
POST   /api/health/weight           # 创建体重记录
PUT    /api/health/weight/{id}      # 更新体重记录
DELETE /api/health/weight/{id}      # 删除体重记录
```

### 5.2 响应格式
```json
{
  "code": 200,
  "message": "成功",
  "data": {
    // 实际数据
  },
  "timestamp": 1234567890
}
```

### 5.3 错误响应
```json
{
  "code": 400,
  "message": "请求参数错误",
  "timestamp": 1234567890
}
```

---

## 6. 安全设计

### 6.1 认证与授权
- 使用 JWT Token 进行无状态认证
- 前端 Token 存储在 LocalStorage
- 后端验证 Token 合法性和过期时间
- 所有API请求都需要有效的 Token

### 6.2 加密策略
- 用户密码使用 bcrypt 加密存储
- 敏感数据传输采用 HTTPS
- 数据库敏感字段加密存储

### 6.3 CORS 跨域处理
- 配置允许的来源
- 仅允许必要的HTTP方法
- 设置合理的预检缓存时间

---

## 7. 性能优化

### 7.1 前端优化
- 使用 Vite 快速构建和热更新
- 路由懒加载
- 组件按需加载
- 图表数据分页展示

### 7.2 后端优化
- 数据库查询优化 (合理使用索引)
- 使用 Redis 缓存热点数据
- API 接口分页返回
- 定时任务异步处理

### 7.3 数据库优化
- 使用连接池管理连接
- 定期维护索引
- 分页查询避免大数据集

---

## 8. 部署架构

### 8.1 开发环境
- 前端：Vite dev server (http://localhost:5173)
- 后端：Spring Boot dev server (http://localhost:8080)
- 数据库：MySQL 本地或容器化

### 8.2 生产环境
- 前端：Nginx 静态文件服务
- 后端：Docker 容器化部署
- 数据库：MySQL 独立服务器
- 监控：日志聚合、性能监控

---

## 9. 开发工具与环境

### 9.1 开发工具
- **IDE**：IntelliJ IDEA (后端) / VS Code (前端)
- **版本控制**：Git + GitHub/GitLab
- **包管理**：Maven (后端) / npm / yarn (前端)
- **构建工具**：Vite (前端) / Maven (后端)

### 9.2 运行环境
- **JDK**：Java 11 或更高版本
- **Node.js**：16.x 或更高版本
- **MySQL**：8.0 或更高版本
- **Redis**：6.0 或更高版本 (可选)

---

## 10. 开发流程

### 10.1 代码规范
- 遵循阿里巴巴Java开发手册
- Vue.js 遵循官方风格指南
- 提交前进行 ESLint 和 Checkstyle 检查

### 10.2 版本控制
- 使用 Git Flow 工作流
- Feature 分支用于新功能开发
- Release 分支用于版本发布
- Hotfix 分支用于紧急修复

### 10.3 代码审查
- Pull Request 前进行代码审查
- 至少一个开发者同意才能合并
- 修复所有 linter 和测试问题

---

**文档版本**：1.0  
**最后更新**：2025年11月15日
