# 第2周系统快速开始指南

## 🚀 快速启动

### 步骤1: 启动后端

1. 打开终端，进入backend目录
```bash
cd backend
```

2. 确保MySQL已启动并创建数据库：
```sql
CREATE DATABASE health_management_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

3. 修改 `application.yml` 中的数据库连接信息（如果需要）

4. 启动Spring Boot应用：
```bash
mvn spring-boot:run
# 或者使用IDE的Run按钮
```

5. 等待启动完成，你应该看到类似信息：
```
Application 'health-management-system' started on port(s) 8080
```

### 步骤2: 启动前端

1. 打开新的终端，进入frontend目录
```bash
cd frontend
```

2. 安装依赖（如果还未安装）：
```bash
npm install
```

3. 启动开发服务器：
```bash
npm run dev
```

4. 你会看到类似输出：
```
Local:        http://localhost:5173/
```

### 步骤3: 访问应用

1. 在浏览器中访问: `http://localhost:5173`
2. 你会看到首页，显示"欢迎使用个人健康管理系统"

---

## 🧪 功能测试

### 测试流程1: 用户注册

1. **打开注册页面**
   - 点击"注册"按钮
   - URL应变为 `http://localhost:5173/register`

2. **填写注册表单**
   - 用户名: `testuser` (3-50字符)
   - 邮箱: `test@example.com` (有效邮箱格式)
   - 密码: `password123` (至少6字符)
   - 确认密码: `password123` (与密码一致)

3. **提交表单**
   - 点击"注 册"按钮
   - 应出现成功提示
   - 自动重定向到登录页

4. **检查数据库**
   ```sql
   SELECT * FROM users WHERE username = 'testuser';
   ```
   - 应该看到新用户信息
   - 密码字段应为加密后的值（BCrypt）

### 测试流程2: 用户登录

1. **打开登录页面**
   - URL应为 `http://localhost:5173/login`

2. **填写登录表单**
   - 用户名: `testuser` (或邮箱 `test@example.com`)
   - 密码: `password123`

3. **提交表单**
   - 点击"登 录"按钮
   - 应出现成功提示
   - 自动重定向到首页

4. **验证登录状态**
   - 首页应显示 "欢迎, testuser!"
   - 应显示用户信息卡片
   - 应显示"个人信息"按钮和"登出"按钮

### 测试流程3: 个人信息管理

1. **访问个人信息页面**
   - 从首页点击"个人信息"按钮
   - URL应为 `http://localhost:5173/profile/1` (id为实际用户ID)

2. **查看个人信息**
   - 应显示用户的基本信息（用户名、邮箱、真实姓名等）

3. **编辑个人信息**
   - 点击"编辑信息"按钮
   - 修改以下字段:
     * 真实姓名: `张三`
     * 性别: 选择"男"
     * 身高: `170` (cm)
     * 目标体重: `65` (kg)
     * 个人简介: `这是一个测试简介`
   - 点击"保存修改"按钮
   - 应出现成功提示
   - 返回查看模式，新信息应已保存

4. **修改密码**
   - 在同一页面向下滚动到"修改密码"部分
   - 填写:
     * 旧密码: `password123`
     * 新密码: `newpassword123`
     * 确认新密码: `newpassword123`
   - 点击"修改密码"按钮
   - 应出现成功提示
   - 自动重定向到登录页面

5. **用新密码重新登录**
   - 用户名: `testuser`
   - 密码: `newpassword123`
   - 应成功登录

### 测试流程4: 登出

1. **从首页登出**
   - 登录后回到首页
   - 点击"登出"按钮
   - 弹出确认对话框

2. **确认登出**
   - 点击"确定"按钮
   - 应出现成功提示
   - 自动重定向到首页
   - 首页应变为未登录状态，显示登录和注册按钮

### 测试流程5: 系统健康检查

1. **检查系统状态**
   - 从任何页面点击"检查系统状态"按钮
   - 应出现 "系统正常运行!" 的成功提示

2. **查看系统信息**
   - 首页下方应显示系统信息卡片，包括:
     * 系统名称: `个人健康管理系统`
     * 版本: `1.0.0`
     * Java版本: 你的Java版本
     * 操作系统: 你的操作系统

---

## 🔍 API调试

### 使用Swagger查看API文档

1. 访问: `http://localhost:8080/swagger-ui.html`
2. 可以看到所有API端点和文档

### 使用Postman测试API

**注册API**
```
POST /api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123",
  "confirmPassword": "password123"
}
```

**登录API**
```
POST /api/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "password123"
}
```

响应示例：
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9...",
    "tokenType": "Bearer",
    "userId": 1,
    "username": "testuser",
    "email": "test@example.com",
    "realName": null,
    "expiresIn": 86400000
  }
}
```

**获取用户信息**
```
GET /api/users/1
Authorization: Bearer <your-token-here>
```

**更新用户信息**
```
PUT /api/users/1
Authorization: Bearer <your-token-here>
Content-Type: application/json

{
  "realName": "张三",
  "gender": 1,
  "height": 170,
  "weightGoal": 65
}
```

**修改密码**
```
POST /api/users/1/change-password
Authorization: Bearer <your-token-here>

?oldPassword=password123&newPassword=newpassword123
```

---

## 🐛 常见问题排查

### 问题1: 后端无法启动

**错误**: `java.sql.SQLNonTransientConnectionException`
- **原因**: 数据库未启动或连接信息不正确
- **解决方案**:
  1. 确保MySQL已启动
  2. 检查 `application.yml` 中的数据库连接信息
  3. 确保数据库已创建

### 问题2: 前端无法连接后端

**错误**: `Network Error` 或 `CORS error`
- **原因**: 后端未启动或CORS配置问题
- **解决方案**:
  1. 确保后端已启动在 `http://localhost:8080`
  2. 检查 `frontend/src/api/request.js` 中的 `baseURL` 是否正确

### 问题3: 登录时提示 "用户不存在"

- **原因**: 用户名或邮箱输入错误，或用户未注册
- **解决方案**:
  1. 确保已完成注册流程
  2. 使用注册时的用户名或邮箱
  3. 检查大小写是否一致

### 问题4: 密码错误

- **原因**: 密码输入错误
- **解决方案**:
  1. 确保密码输入正确
  2. 检查Caps Lock是否打开
  3. 使用"重置密码"功能重新设置密码

### 问题5: 修改个人信息后显示未保存

- **原因**: API调用失败或Token过期
- **解决方案**:
  1. 检查浏览器控制台是否有错误
  2. 重新登录以刷新Token
  3. 查看后端服务器日志

### 问题6: Token失效

- **错误**: 自动重定向到登录页
- **原因**: Token已过期或被清除
- **解决方案**:
  1. 重新登录
  2. 检查浏览器localStorage中的token

---

## 📊 数据库检查

### 查看用户表
```sql
SELECT id, username, email, realName, gender, height, weightGoal, 
       isActive, lastLogin, createTime, updateTime 
FROM users;
```

### 查看特定用户
```sql
SELECT * FROM users WHERE username = 'testuser';
```

### 清空测试数据（谨慎操作）
```sql
DELETE FROM users WHERE username = 'testuser';
```

---

## 💡 开发提示

### 浏览器开发者工具

1. **查看localStorage**
   - 打开浏览器DevTools (F12)
   - 到 Application 标签
   - 查看 Storage > Local Storage
   - 应该看到 `token` 和 `user` 的键值对

2. **查看网络请求**
   - 打开浏览器DevTools (F12)
   - 到 Network 标签
   - 执行操作（登录、提交表单等）
   - 查看请求和响应详情

3. **查看控制台错误**
   - 打开浏览器DevTools (F12)
   - 到 Console 标签
   - 查看任何JavaScript错误

### 后端日志

在服务器启动时查看日志：
- 用户注册: `用户注册成功: testuser`
- 用户登录: `用户登录成功: testuser`
- 执行健康检查: `执行健康检查`
- 获取系统信息: `获取系统信息`

---

## ✅ 验证检查清单

在第2周功能全部完成后，请验证以下项目：

- [ ] 后端能成功启动在端口8080
- [ ] 前端能成功启动在端口5173
- [ ] 能访问首页并显示欢迎信息
- [ ] 能成功注册新用户
- [ ] 能成功登录已注册用户
- [ ] 能查看个人信息
- [ ] 能编辑个人信息并保存
- [ ] 能修改密码
- [ ] 能使用新密码登录
- [ ] 能成功登出
- [ ] 系统健康检查成功
- [ ] 系统信息正确显示
- [ ] 数据库中能看到新用户
- [ ] Swagger文档能正常访问
- [ ] 所有API都能通过Postman成功调用

---

## 🎉 大功告成！

恭喜！第2周的用户认证系统已完全实现。系统现在准备好进入第3周的体重管理模块开发。

如有任何问题或需要进一步的测试，请参考本指南或检查相关的日志。

